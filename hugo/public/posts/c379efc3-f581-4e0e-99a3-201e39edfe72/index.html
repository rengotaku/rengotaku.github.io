<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name=" robots" content="noindex, nofollow">
<title>Crowdtech(クラウドテック)の勤怠で不足時間を計算するスクリプト | Vegetable Programing</title>

<meta name="keywords" content="javascript, 小技, tool, ベジプロ, プログ, プログラム" />
<meta name="description" content="ソース javascript:function reportToHash(e){const tds=[];e.querySelectorAll(&#39;td&#39;).forEach(function(e){tds.push(e)});const rawDay=tds[1].textContent;const dayInfo=rawDay.split(&#39; &#39;);const week=dayInfo[1].replace(/\(|\)/gi,&#39;&#39;);const startTime=tds[2].textContent;const endTime=tds[3].textContent;const breakTime=tds[4].textContent;const description=tds[6].textContent;const rawWorkTime=tds[5].textContent;const weekdaysFlag=(week==&#39;土&#39;||week==&#39;日&#39;);const vacationFlag=weekdaysFlag&amp;&amp;rawWorkTime==&#39;&#39;;if(vacationFlag||rawWorkTime==&#39;-&#39;){return{&quot;workTime&quot;:0,&quot;weekdaysFlag&quot;:weekdaysFlag,&quot;vacationFlag&quot;:true,&quot;description&quot;:description,}}var workTime=0;if(rawWorkTime!=&#39;&#39;){const times=rawWor">
<meta name="author" content="">
<link rel="canonical" href="https://www.vegetable.blog.v41.me/posts/c379efc3-f581-4e0e-99a3-201e39edfe72/" />
<link href="https://www.vegetable.blog.v41.me/assets/css/stylesheet.min.08d6f2005b6ce4ed10207916c0411c66e66f2201e3f7a56e8fb2ccbc4a8b259c.css" integrity="sha256-CNbyAFts5O0QIHkWwEEcZuZvIgHj96Vuj7LMvEqLJZw=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="https://www.vegetable.blog.v41.me/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.vegetable.blog.v41.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.vegetable.blog.v41.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.vegetable.blog.v41.me/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.vegetable.blog.v41.me/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.68.3" />




</head>

<body class="single" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        .theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.vegetable.blog.v41.me" accesskey="h">Vegetable Programing</a>
            <span class="logo-switches">
                <span class="theme-toggle">
                    <a id="theme-toggle" accesskey="t">
                        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </a>
                </span>
                
            </span>
        </div>
        <ul class="menu" id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://www.vegetable.blog.v41.me/about/">
                    <span>
                        about me
                    </span>
                </a>
            </li>
            <li>
                <a href="https://www.vegetable.blog.v41.me/archive/">
                    <span>
                        archive
                    </span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">
      Crowdtech(クラウドテック)の勤怠で不足時間を計算するスクリプト
    </h1>
    <div class="post-meta">December 9, 2019

    </div>
  </header> 

  <div class="post-content">
<h1 id="ソース">ソース<a hidden class="anchor" aria-hidden="true" href="#ソース">#</a></h1>
<pre><code class="language-js:Bookmarklet" data-lang="js:Bookmarklet">javascript:function reportToHash(e){const tds=[];e.querySelectorAll('td').forEach(function(e){tds.push(e)});const rawDay=tds[1].textContent;const dayInfo=rawDay.split(' ');const week=dayInfo[1].replace(/\(|\)/gi,'');const startTime=tds[2].textContent;const endTime=tds[3].textContent;const breakTime=tds[4].textContent;const description=tds[6].textContent;const rawWorkTime=tds[5].textContent;const weekdaysFlag=(week=='土'||week=='日');const vacationFlag=weekdaysFlag&amp;&amp;rawWorkTime=='';if(vacationFlag||rawWorkTime=='-'){return{&quot;workTime&quot;:0,&quot;weekdaysFlag&quot;:weekdaysFlag,&quot;vacationFlag&quot;:true,&quot;description&quot;:description,}}var workTime=0;if(rawWorkTime!=''){const times=rawWorkTime.replace(/(\d{1,2})時間(\d{1,2})分/gi,'$1:$2').split(':');workTime=parseInt(times[0]*60)+parseInt(times[1])}return{&quot;day&quot;:dayInfo[0].replace(/日/gi,''),&quot;week&quot;:week,&quot;start&quot;:startTime,&quot;end&quot;:endTime,&quot;breakTime&quot;:breakTime,&quot;workTime&quot;:workTime,&quot;description&quot;:description,&quot;weekdaysFlag&quot;:weekdaysFlag,&quot;vacationFlag&quot;:false,}}function workTime(){const limitTime=document.querySelector('body &gt; div.main.l-main &gt; div.wrapper &gt; div:nth-child(3) &gt; div.d-flex.flex-wrap.justify-content-between &gt; div.col-12.col-md-6.col-lg-4 &gt; table &gt; tbody &gt; tr &gt; td:nth-child(2)').textContent;minAndMax=limitTime.split('~');return[minAndMax[0].replace(/時間/gi,''),minAndMax[1].replace(/時間/gi,'')]}function minWorkMinutes(){return calM(workTime()[0])}function maxWorkMinutes(){return calM(workTime()[1])}function calM(hour){return hour*60}function calMFromD(day){return day*60*8}function calH(minutes){return minutes/60}function calD(hour){return hour/8}function calDFromM(minutes){return(minutes/60)/8}function pushMessage(messages,title,content){messages.push(title+&quot;：&quot;+content.toString())}function main(){var weekdaysCount=0;var vacationCount=0;var workedMinutes=0;var workedCount=0;var totalWorkCount=0;document.querySelectorAll('table.table .report-row').forEach(function(e){const report=reportToHash(e);if(report[&quot;vacationFlag&quot;]){vacationCount+=1;if(report[&quot;weekdaysFlag&quot;]){weekdaysCount+=1}}else{if(report[&quot;workTime&quot;]&gt;0){workedCount+=1;workedMinutes+=report[&quot;workTime&quot;]}totalWorkCount+=1}});const scheduledMinutes=calMFromD(totalWorkCount-workedCount);const planWorkMinutes=workedMinutes+scheduledMinutes;var messages=[];messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);pushMessage(messages,&quot;稼働（時）&quot;,Math.floor(calH(workedMinutes)));pushMessage(messages,&quot;予定稼働（時）&quot;,Math.floor(calH(planWorkMinutes)));pushMessage(messages,&quot;稼働数（日）&quot;,workedCount+&quot; (残:&quot;+(totalWorkCount-workedCount)+&quot;)&quot;);pushMessage(messages,&quot;稼働予定数（日）&quot;,totalWorkCount);pushMessage(messages,&quot;休日数（日）&quot;,vacationCount+&quot; (土・日:&quot;+weekdaysCount+&quot;, 有給:&quot;+(vacationCount-weekdaysCount)+&quot;)&quot;);const overWorkMinutes=(workedMinutes+scheduledMinutes)-maxWorkMinutes();if(overWorkMinutes&gt;=60){pushMessage(messages,&quot;★過労時間（時）&quot;,Math.floor(calH(overWorkMinutes)));messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);messages.push(&quot;(・ω・｀三´・ω・). &lt; 上限を超えそう!?&quot;);return messages}if(workedMinutes-minWorkMinutes()&gt;=0){messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);messages.push(&quot;ヾ(○⌒∇⌒○)ﾉ &lt; 目標達成!!!!!&quot;);return messages}const mustWorkMinutes=minWorkMinutes()-workedMinutes;if(mustWorkMinutes&lt;scheduledMinutes){if(scheduledMinutes-mustWorkMinutes&lt;60){pushMessage(messages,&quot;★余裕時間（分）&quot;,scheduledMinutes-mustWorkMinutes)}else{messages.push(&quot;★余裕時間（時）&quot;+Math.floor(calH(scheduledMinutes-mustWorkMinutes)));if(scheduledMinutes-mustWorkMinutes&gt;60*8){pushMessage(messages,&quot;★休み可能日数&quot;,Math.floor(calDFromM(scheduledMinutes-mustWorkMinutes)))}}messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);messages.push(&quot;( ＾∀＾) &lt; 残業なしで達成可能!&quot;);return messages}const lackMinutes=mustWorkMinutes-scheduledMinutes;if(lackMinutes&lt;60){pushMessage(messages,&quot;◉不足時間（分）&quot;,lackMinutes)}else{pushMessage(messages,&quot;◉不足時間（時）&quot;,Math.ceil(calH(lackMinutes)));const avarageOverMinutes=Math.ceil(lackMinutes/(totalWorkCount-workedCount));if(avarageOverMinutes&lt;60){pushMessage(messages,&quot;◉平均残業&quot;,&quot;1時間未満&quot;)}else{pushMessage(messages,&quot;◉平均残業（時）&quot;,Math.ceil(calH(avarageOverMinutes)*10)/10)}}messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);messages.push(&quot;( ;´・ω・`) &lt; 残業しなきゃ...&quot;);return messages};window.alert(main().join(&quot;\n&quot;));
</code></pre><blockquote>
<p><a href="http://dean.edwards.name/packer/">/packer/</a></p>
</blockquote>
<pre><code class="language-js:整形前" data-lang="js:整形前">/**
 * Do compress at https://javascriptcompressor.com/
 **/
function reportToHash(e) {
  const tds = [];
  e.querySelectorAll('td').forEach(function(e) {
    tds.push(e);
  });

  // 1日 (日)
  const rawDay = tds[1].textContent;
  const dayInfo = rawDay.split(' ');
  const week = dayInfo[1].replace(/\(|\)/gi, '');

  // 09:34
  const startTime = tds[2].textContent;
  // 19:11
  const endTime = tds[3].textContent;
  // 60分
  const breakTime = tds[4].textContent;
  // 資料まとめ
  const description = tds[6].textContent;
  // 8時間30分
  const rawWorkTime = tds[5].textContent;

  const weekdaysFlag = (week == '土' || week == '日');
  const vacationFlag = weekdaysFlag &amp;&amp; rawWorkTime == '';
  if(vacationFlag || rawWorkTime == '-') {
    return {
      &quot;workTime&quot;: 0,
      &quot;weekdaysFlag&quot;: weekdaysFlag,
      &quot;vacationFlag&quot;: true,
      &quot;description&quot;: description,
    }
  }
  var workTime = 0;
  if(rawWorkTime != '') {
    const times = rawWorkTime.replace(/(\d{1,2})時間(\d{1,2})分/gi, '$1:$2').split(':');
    workTime = parseInt(times[0] * 60) + parseInt(times[1]);
  }

  return {
    &quot;day&quot;: dayInfo[0].replace(/日/gi, ''),
    &quot;week&quot;: week,
    &quot;start&quot;: startTime,
    &quot;end&quot;: endTime,
    &quot;breakTime&quot;: breakTime,
    &quot;workTime&quot;: workTime,
    &quot;description&quot;: description,
    &quot;weekdaysFlag&quot;: weekdaysFlag,
    &quot;vacationFlag&quot;: false,
  }
}

function workTime() {
  // 140時間~180時間
  const limitTime = document.querySelector('body &gt; div.main.l-main &gt; div.wrapper &gt; div:nth-child(3) &gt; div.d-flex.flex-wrap.justify-content-between &gt; div.col-12.col-md-6.col-lg-4 &gt; table &gt; tbody &gt; tr &gt; td:nth-child(2)').textContent;
  minAndMax = limitTime.split('~');
  return [minAndMax[0].replace(/時間/gi, ''), minAndMax[1].replace(/時間/gi, '')];
}
function minWorkMinutes() {
  return calM(workTime()[0]);
}
function maxWorkMinutes() {
  return calM(workTime()[1]);
}

function calM(hour) {
  return hour * 60;
}
function calMFromD(day) {
  return day * 60 * 8;
}
function calH(minutes) {
  return minutes / 60;
}
function calD(hour) {
  return hour / 8;
}
function calDFromM(minutes) {
  return (minutes / 60) / 8;
}
function pushMessage(messages, title, content) {
  messages.push(title + &quot;：&quot; + content.toString());
}

function main() {
  var weekdaysCount = 0;
  var vacationCount = 0;
  var workedMinutes = 0;
  var workedCount = 0;
  var totalWorkCount = 0;
  document.querySelectorAll('table.table .report-row').forEach(function(e) {
    const report = reportToHash(e);
    if(report[&quot;vacationFlag&quot;]) {
      vacationCount += 1;
      if(report[&quot;weekdaysFlag&quot;]){
        weekdaysCount += 1;
      }
    } else {
      if(report[&quot;workTime&quot;] &gt; 0) {
        workedCount += 1;
        workedMinutes += report[&quot;workTime&quot;];
      }
      totalWorkCount += 1;
    }
  });

  const scheduledMinutes = calMFromD(totalWorkCount - workedCount);
  const planWorkMinutes = workedMinutes + scheduledMinutes;

  var messages = [];
  messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);
  pushMessage(messages, &quot;稼働（時）&quot;, Math.floor(calH(workedMinutes)));
  pushMessage(messages, &quot;予定稼働（時）&quot;, Math.floor(calH(planWorkMinutes)));
  pushMessage(messages, &quot;稼働数（日）&quot;, workedCount + &quot; (残:&quot; + (totalWorkCount - workedCount) + &quot;)&quot;);
  pushMessage(messages, &quot;稼働予定数（日）&quot;, totalWorkCount);
  pushMessage(messages, &quot;休日数（日）&quot;, vacationCount + &quot; (土・日:&quot; + weekdaysCount + &quot;, 有給:&quot; + (vacationCount - weekdaysCount) + &quot;)&quot;);

  const overWorkMinutes = (workedMinutes + scheduledMinutes) - maxWorkMinutes();
  if(overWorkMinutes &gt;= 60) {
    pushMessage(messages, &quot;★過労時間（時）&quot;, Math.floor(calH(overWorkMinutes)));

    messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);
    messages.push(&quot;(・ω・｀三´・ω・). &lt; 上限を超えそう!?&quot;);

    return messages;
  }

  if(workedMinutes - minWorkMinutes() &gt;= 0) {
    messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);
    messages.push(&quot;ヾ(○⌒∇⌒○)ﾉ &lt; 目標達成!!!!!&quot;);

    return messages;
  }

  const mustWorkMinutes = minWorkMinutes() - workedMinutes;
  if(mustWorkMinutes &lt; scheduledMinutes) {
    if(scheduledMinutes - mustWorkMinutes &lt; 60) {
      pushMessage(messages, &quot;★余裕時間（分）&quot;, scheduledMinutes - mustWorkMinutes);
    } else {
      messages.push(&quot;★余裕時間（時）&quot; + Math.floor(calH(scheduledMinutes - mustWorkMinutes)));

      if(scheduledMinutes - mustWorkMinutes &gt; 60 * 8) {
        pushMessage(messages, &quot;★休み可能日数&quot;, Math.floor(calDFromM(scheduledMinutes - mustWorkMinutes)));
      }
    }

    messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);
    messages.push(&quot;( ＾∀＾) &lt; 残業なしで達成可能!&quot;);

    return messages;
  }

  const lackMinutes = mustWorkMinutes - scheduledMinutes;
  if(lackMinutes &lt; 60) {
    pushMessage(messages, &quot;◉不足時間（分）&quot;, lackMinutes);
  } else {
    pushMessage(messages, &quot;◉不足時間（時）&quot;, Math.ceil(calH(lackMinutes)));

    const avarageOverMinutes = Math.ceil(lackMinutes / (totalWorkCount - workedCount));
    if(avarageOverMinutes &lt; 60) {
      pushMessage(messages, &quot;◉平均残業&quot;, &quot;1時間未満&quot;);
    } else {
      pushMessage(messages, &quot;◉平均残業（時）&quot;, Math.ceil(calH(avarageOverMinutes) * 10) / 10);
    }
  }

  messages.push(&quot;~~~~~~~~~~~~~~~~~&quot;);
  messages.push(&quot;( ;´・ω・`) &lt; 残業しなきゃ...&quot;);

  return messages;
};

window.alert(main().join(&quot;\n&quot;));
</code></pre><h1 id="実行方法">実行方法<a hidden class="anchor" aria-hidden="true" href="#実行方法">#</a></h1>
<p>Crowdtechの勤怠ページで該当スクリプトを実行する。
下記みたいなメッセージが出力される。</p>
<pre><code>~~~~~~~~~~~~~~~~~
休日数: 11 (土・日:9, 有給:2)
稼働時間(時): 105.75
稼働日数: 14 (残:6)
稼働予定数: 20
☆ 余裕時間(時): 13
☆ 休み可能日数: 1
~~~~~~~~~~~~~~~~~
( ＾∀＾) &lt; 残業なしで達成可能!
</code></pre>
</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.vegetable.blog.v41.me/tags/javascript">javascript</a></li>
      <li><a href="https://www.vegetable.blog.v41.me/tags/%E5%B0%8F%E6%8A%80">小技</a></li>
      <li><a href="https://www.vegetable.blog.v41.me/tags/tool">tool</a></li>
    </ul>
  </footer>
</article>
    </main><footer class="footer">
    <span>©2018-2020 Vegetable Programing.</span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top" accesskey="g">
    <button class="top-link" id="top-link" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6">
            <path d="M12 6H0l6-6z" /></svg>
    </button>
</a>



<script defer src="https://www.vegetable.blog.v41.me/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js" integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w="
    onload="hljs.initHighlightingOnLoad();"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                behavior: "smooth"
            });
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>

</body>

</html>
